define(["jquery"],(function(t){function e(e){t("body > "+e.bubble).remove()}return{init:function(o){t.fn.isOnScreen=function(t,e){null!=t&&void 0!==t||(t=1),null!=e&&void 0!==e||(e=1);var o=jQuery(window),i={top:o.scrollTop(),left:o.scrollLeft()};i.right=i.left+o.width(),i.bottom=i.top+o.height();var r=this.outerHeight(),s=this.outerWidth();if(!s||!r)return!1;var n=this.offset();if(n.right=n.left+s,n.bottom=n.top+r,!!(i.right<n.left||i.left>n.right||i.bottom<n.top||i.top>n.bottom))return!1;var l=Math.min(1,(n.bottom-i.top)/r),b=Math.min(1,(i.bottom-n.top)/r);return Math.min(1,(n.right-i.left)/s)*Math.min(1,(i.right-n.left)/s)>=t&&l*b>=e},o=function(t){return void 0===t&&(t={}),void 0===t.target&&(t.target=".bubble-target"),void 0===t.bubble&&(t.bubble=".bubble-content"),t}(o),t(".listing-share-buttons .uloop-st-button-24-wrap .uloop-st-button-24").length?(t(document).click((function(e){t(e.target).closest(o.bubble).length||t(o.bubble).is(":visible")&&t(o.bubble).fadeOut(100)})),t(window).on("resize",(function(){t(o.bubble).each((function(e,i){t(i).is(":visible")&&(t(i).isOnScreen(1,0)||("auto"==t(i)[0].style.left?(t(i).css({left:0,right:"auto",top:t(i).closest(o.target).height()+8+"px"}),t(i).find(".arrow-before").css({left:t(i).closest(o.target).width()/2+"px",right:"auto"}),t(i).find(".arrow-after").css({left:t(i).closest(o.target).width()/2+"px",right:"auto"})):(t(i).css({right:0,left:"auto",top:t(i).closest(o.target).height()+8+"px"}),t(i).find(".arrow-before").css({right:t(i).closest(o.target).width()/2+"px",left:"auto"}),t(i).find(".arrow-after").css({right:t(i).closest(o.target).width()/2+"px",left:"auto"}))))}))})),t("body").off("click",o.target),t("body").on("click",o.target,(function(e){if(t(e.target).hasClass(o.bubble.replace(".",""))||t(e.target).closest(o.bubble).length)return!0;var i=this,r=t(this).find(o.bubble);return t(r).find(".arrow-before").length||t(r).append('<span class="arrow-before"></span><span class="arrow-after"></span>'),t(r).css({right:0,left:"auto",top:t(this).height()+8+"px"}),t(r).find(".arrow-before").css({right:t(this).width()/2+"px",left:"auto"}),t(r).find(".arrow-after").css({right:t(this).width()/2+"px",left:"auto"}),t(r).is(":visible")?t(r).hide():(t(r).show(),t(r).isOnScreen(1,0)||(t(r).css({left:0,right:"auto",top:t(i).height()+8+"px"}),t(r).find(".arrow-before").css({left:t(i).width()/2+"px",right:"auto"}),t(r).find(".arrow-after").css({left:t(i).width()/2+"px",right:"auto"}))),!1}))):(t("body").on("click",(function(i){t(i.target).closest(o.bubble).length||(console.log("click outside bubble"),e(o),t(o.bubble).hide())})),t(document).on("touchstart",(function(i){t(i.target).closest(o.bubble).length||t(i.target).closest(o.target).length||(console.log("click outside bubble"),e(o),t(o.bubble).hide())})),t(window).on("resize",(function(){t(o.bubble).hide(),e(o)})),t("body").off("click",o.target),t("body").on("click",o.bubble+" a",(function(i){console.log("click bubble"),e(o),t(o.bubble).hide()})),t("body").on("click",o.target,(function(i){if(t(i.target).hasClass(o.bubble.replace(".",""))||t(i.target).closest(o.bubble).length)return!0;t(o.bubble).hide(),e(o);var r=this,s=t(this).find(o.bubble).clone();return t("body").append(s),t(s).find(".arrow-before").length||t(s).append('<span class="arrow-before"></span><span class="arrow-after"></span>'),t(s).css({left:t(this).offset().left-t(s).outerWidth(!0)+t(this).outerWidth()+"px",top:t(this).offset().top+6+t(this).height()-parseInt(t("#content").css("margin-top"))+"px"}),t(s).find(".arrow-before").css({right:t(this).width()/2+"px",left:"auto"}),t(s).find(".arrow-after").css({right:t(this).width()/2+"px",left:"auto"}),t(s).is(":visible")?(t(s).hide(),e(o)):(t(s).show(),t(s).isOnScreen(1,0)||(t(s).css({left:t(r).offset().left+t(r).outerWidth(!0)-t(s).outerWidth(!0)+"px",top:t(r).offset().top+6+t(r).height()-parseInt(t("#content").css("margin-top"))+"px"}),t(s).find(".arrow-before").css({left:t(r).width()/2+"px",right:"auto"}),t(s).find(".arrow-after").css({left:t(r).width()/2+"px",right:"auto"}))),!1})))}}}));